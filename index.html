<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Another Product Invented â€“ Pente Grammai</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #fff;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      margin: 1rem 0 0.5rem;
      text-align: center;
      line-height: 1.2;
    }
    #gameContainer {
      position: relative;
      width: 500px;
      max-width: 100%;
      margin-bottom: 10px;
      border: 2px solid #333;
      background: #fafafa;
    }
    canvas {
      display: block;
      width: 100%;
      height: auto;
      background: #eee;
      touch-action: none;
    }
    #controls {
      margin: 10px;
      font-size: 16px;
    }
    #diceResult {
      font-weight: bold;
      margin-left: 10px;
      font-size: 18px;
    }
  </style>
</head>
<body>

<h1>Another Product Invented<br>Pente Grammai</h1>

<div id="gameContainer">
  <canvas id="gameCanvas" width="500" height="500"></canvas>
</div>

<div id="controls">
  <button id="rollDiceBtn">Roll Dice</button>
  <span>Dice: <span id="diceResult">0</span></span>
</div>

<script>
/*
  We have 5 horizontal lines (0..4). We'll place 10 total pieces on line #2 (the middle line):
    - 5 belong to the player (blue),
    - 5 belong to the AI (red).

  We'll represent each piece as { line: 2, col: someColumn, owner: 'player'/'ai' }.
  We can move them left or right (for example) by the dice roll. This is a minimal approach.
*/

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const rollDiceBtn = document.getElementById("rollDiceBtn");
const diceResultSpan = document.getElementById("diceResult");

const width = canvas.width;
const height = canvas.height;

const NUM_LINES = 5;
const COLS_PER_LINE = 11;  // Enough horizontal "spots" to move pieces
const LINE_SPACING = height / (NUM_LINES + 1);
const COL_SPACING = width / (COLS_PER_LINE + 1);

let pieces = []; // Will store objects like { line, col, owner }
let currentTurn = 'player';
let diceValue = 0;
let gameActive = true;

// Initialize 10 total pieces in the middle line (#2).
// We'll place the player's 5 pieces on columns 0..4 and the AI's 5 pieces on columns 6..10
function initGame() {
  pieces = [];
  // Player pieces in columns 0..4
  for (let c = 0; c < 5; c++) {
    pieces.push({ line: 2, col: c, owner: 'player' });
  }
  // AI pieces in columns 6..10
  for (let c = 6; c < 11; c++) {
    pieces.push({ line: 2, col: c, owner: 'ai' });
  }
  currentTurn = 'player'; // Player starts
  diceValue = 0;
  gameActive = true;
  drawBoard();
}

function drawBoard() {
  ctx.clearRect(0, 0, width, height);
  ctx.strokeStyle = '#000';
  ctx.lineWidth = 2;

  // Draw the 5 horizontal lines
  for (let i = 1; i <= NUM_LINES; i++) {
    let y = LINE_SPACING * i;
    ctx.beginPath();
    ctx.moveTo(COL_SPACING, y);
    ctx.lineTo(COL_SPACING * COLS_PER_LINE, y);
    ctx.stroke();
  }

  // Draw pieces
  pieces.forEach(p => {
    drawPiece(p);
  });
}

function drawPiece(piece) {
  // Convert line+col into x,y
  let y = LINE_SPACING * (piece.line + 1);
  let x = COL_SPACING * (piece.col + 1);

  ctx.beginPath();
  ctx.arc(x, y, 12, 0, Math.PI * 2);
  ctx.closePath();
  if (piece.owner === 'player') {
    ctx.fillStyle = 'blue';
  } else {
    ctx.fillStyle = 'red';
  }
  ctx.fill();
  ctx.strokeStyle = '#000';
  ctx.stroke();
}

// Basic dice roll: 1..6
function rollDice() {
  if (!gameActive) return;
  if (diceValue !== 0) {
    // Already rolled this turn
    return;
  }
  let val = Math.floor(Math.random() * 6) + 1;
  diceValue = val;
  diceResultSpan.textContent = val.toString();
  // If it's AI's turn, call AI logic
  if (currentTurn === 'ai') {
    setTimeout(aiMove, 800);
  }
}

// Player's turn: they must click on a piece to move
// We'll handle that in the canvas click
canvas.addEventListener('click', e => {
  if (!gameActive) return;
  if (currentTurn !== 'player') return; // Only if it's player's turn
  if (diceValue === 0) return;         // Must roll dice first

  // Determine which piece was clicked
  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;

  // Find a piece belonging to 'player' that was clicked
  for (let i = 0; i < pieces.length; i++) {
    let p = pieces[i];
    if (p.owner !== 'player') continue;
    // Convert p.line, p.col to center
    let cy = LINE_SPACING * (p.line + 1);
    let cx = COL_SPACING * (p.col + 1);

    let dx = mx - cx;
    let dy = my - cy;
    if (dx * dx + dy * dy <= 144) { // radius=12 => 12^2=144
      // We clicked this piece
      // Move it "to the right" by diceValue, if possible
      let newCol = p.col + diceValue;
      if (newCol >= COLS_PER_LINE) {
        // Can't move off board => do nothing or handle "winning"
        // For now just skip
        console.log("Can't move off board.");
        return;
      }
      // Check if new spot is occupied
      if (pieces.some(pp => pp.line === p.line && pp.col === newCol)) {
        console.log("That spot is occupied. Can't move.");
        return;
      }
      // Move piece
      p.col = newCol;
      // Check if game is won? (Your rules)
      // We'll skip that for now
      diceValue = 0;
      diceResultSpan.textContent = '0';
      drawBoard();
      // Switch turn
      switchTurn();
      return;
    }
  }
});

function switchTurn() {
  if (!gameActive) return;
  // If we had an extra turn, keep currentTurn
  if (extraTurn) {
    extraTurn = false;
    console.log("Extra turn triggered, staying with " + currentTurn);
    return;
  }
  currentTurn = (currentTurn === 'player') ? 'ai' : 'player';
  if (currentTurn === 'ai') {
    setTimeout(() => {
      rollDice(); // AI auto-rolls
    }, 500);
  }
}

// AI logic
function aiMove() {
  if (!gameActive) return;
  // AI picks a piece to move
  let moves = getAIMoves();
  if (moves.length === 0) {
    // No moves => pass turn
    console.log("AI can't move => pass turn");
    diceValue = 0;
    diceResultSpan.textContent = '0';
    switchTurn();
    return;
  }
  // Just pick first move for example
  let move = moves[0];
  move.piece.col = move.newCol;
  diceValue = 0;
  diceResultSpan.textContent = '0';
  drawBoard();
  switchTurn();
}

function getAIMoves() {
  // Return all possible moves for AI
  let moves = [];
  pieces.forEach(p => {
    if (p.owner !== 'ai') return;
    let newCol = p.col - diceValue; // AI moves left, for example
    if (newCol < 0) return;         // can't move off board
    // Check if occupied
    if (pieces.some(pp => pp.line === p.line && pp.col === newCol)) return;
    moves.push({ piece: p, newCol });
  });
  return moves;
}

// Minimal "can we move" check for the AI
function canMove() {
  // ...
}

// Start
initGame();

rollDiceBtn.addEventListener('click', () => {
  if (currentTurn === 'player') {
    rollDice();
  }
});
</script>
</body>
</html>
